---
title: "K-Means Analysis"
author: "Gloria Wu"
---

```{r}
#| label: setup
#| include: false

# Improve digit display and NA display for kable tables
options(scipen = 1, knitr.kable.NA = "")

# Load necessary packages
library(ggplot2)
library(tidyverse)
library(GGally)

# Load datasets
load("data/k-means-data.Rds")
```

## K-Means Analysis

To conduct the $k$-means analysis, only numerical variables were included, and they were all standardized. Then, an elbow plot was constructed using the ggplot2 package by @ggplot2 to see the optimal amount of clusters to conduct the $k$-means analysis. Finally, visualizations for the $k$-means analysis were generated using the tidyverse package by @tidyverse and GGally package by @GGally. 

### Elbow Plot

```{r}
#| label: elbow plot for k-means analysis

elbow_plot |>
  ggplot(aes(x = k, y = tot.withinss)) +
  geom_point() +
  geom_line() +
  scale_x_continuous(breaks = 1:10) +
  labs(x = "Number of clusters (k)",
       y = "Total within-cluster sum of squares")
```

The elbow plot indicates that there are no significant drops in the total within-cluster sum of squares after 4 clusters, so 4 clusters was used for our $k$-means analysis. 

### Visualizations

Four plots were generated to visualize the differences between clusters and popularity scores. Click through the tabset panels to explore the different visualizations. The title of each panel indicates the three variables that were used to compare clusters and popularity scores.     

::: {.panel-tabset}

### Danceability, Energy, Liveness

```{r}
#| label: k-means analysis plot 1
#| warning: false
#| out-width: 100%
#| fig-height: 7

spotify_k4 |>
  select(Popularity, Danceability, Energy, Liveness, Cluster) |>
  ggpairs(aes(color = Cluster),
          upper = list(continuous = "blank"),
          progress = FALSE) +
  theme(text = element_text(size = 8))
```

All four clusters had relatively high danceability scores, with cluster 3 having the highest and cluster 2 having the lowest. Cluster 4 had the lowest energy score, while cluster 3 had the second lowest. Clusters 1 and 2 had similarly high energy scores. All four clusters had low liveness scores. 

### Key, Tempo, Duration

```{r}
#| label: k-means analysis plot 2
#| warning: false
#| out-width: 100%
#| fig-height: 7

spotify_k4 |>
  select(Popularity, Key, Tempo, Duration, Cluster) |>
  ggpairs(aes(color = Cluster),
          upper = list(continuous = "blank"),
          progress = FALSE) +
  theme(text = element_text(size = 8))
```

There were no significant differences in the key, tempo, and duration of the four clusters. 

### Speechiness, Acousticness, Instrumentalness

```{r}
#| label: k-means analysis plot 3
#| warning: false
#| out-width: 100%
#| fig-height: 7

spotify_k4 |>
  select(Popularity, Speechiness, Acousticness, Instrumentalness, Cluster) |>
  ggpairs(aes(color = Cluster),
          upper = list(continuous = "blank"),
          progress = FALSE) +
  theme(text = element_text(size = 8))
```

All four clusters had extremely low speechiness scores. Clusters 1 and 2 had low acousticness scores, with cluster 3 having a slightly higher score, and cluster 4 having a substantialy higher acousticness score. Clusters 2, 3, and 4 had extremely low instrumentalness scores, while cluster 1 had an extremely high instrumentalness score. 

### Valence, Mode, Loudness

```{r}
#| label: k-means analysis plot 4
#| warning: false
#| out-width: 100%
#| fig-height: 7

spotify_k4 |>
  select(Popularity, Valence, Mode, Loudness, Cluster) |>
  ggpairs(aes(color = Cluster),
          upper = list(continuous = "blank"),
          progress = FALSE) +
  theme(text = element_text(size = 8))
```

Clusters 1, 2, and 4 had similar valence scores, while cluster 3 had a higher valence score. There was no difference in the mode of the four clusters. Clusters 1, 2, and 3 had similar loudness scores, and cluster 4 had a slightly lower loudness score. 

:::

Overall, there was no significant difference in the popularity scores of the four clusters. The order of the popularity scores (from highest to lowest) is cluster 3, cluster 4, cluster 2, cluster 1. 

Packages used for this data analysis were:
