---
title: "Network Map w/ Additional Visuals"
author: "Justyce Williams"
---

```{r}
#| label: setup
#| include: false

# Improve digit display and NA display for kable tables
options(scipen = 1, knitr.kable.NA = "")

# Load necessary packages
# load packages
library(tidyverse)
library(rvest)
library(ggplot2)
library(stringr)
library(purrr)
library(robotstxt)
library(tidytext)
library(tidyr)
library(dplyr)
library(spotifyr)
library(tidytuesdayR)
library(geniusr)
library(httr)
library(jsonlite)
library(broom)
library(GGally)
library(rgenius)
library(igraph)
library(ggraph)
library(tidygraph)
library(sf)
library(leaflet)
library(ggspatial)

# Load datasets
artists<- readRDS("data/networkdata.Rds")
popularity<- readRDS("data/officalbardata.Rds")
hometowns<- readRDS("data/NorthAmericaTotal")

```

## Introduction

To explore connections between artists among top Spotify tracks, we used network science to construct and analyze a collaboration network. In this network, each node represents a unique artist, and edges connect artists who have worked together before. By modeling these relationships as a network, we can observe how artists cluster together, which artists are central to the network, and how collaboration patterns vary across the music industry.

Network analysis helps us do more than just count how many times artists worked together, it allows us  to actually see how those collaborations are structured. By looking at the network, we can figure out which artists play important roles, like being central connectors between groups or part of particular circles that collaborate a lot. For example, we might expect pop artists to be part of big, connected clusters because they tend to collaborate more often, while artists from smaller or more niche genres might be more on the edges of the network. Given the use of this spotify dataset, when filter for top our tracks, a majority of the songs are pop genre, thus we will see many connections in the dominating pop genre circles. 

To create the network, we first scrapped and downloaded information from Wikipedia to gain an understanding of which artist have crossed paths professionally. Then that data was filtered to include only unique artist-to-artist collaborations. Then, we used visualizations using centrality metrics to highlight popular artists amongst those groups to examine the overall connectivity of the network. Through this analysis, we hope to gain insight into how collaborative behavior influences visibility, crossovers with genre, and the formation of musical communities or pods. 


### Variables 
Number of Variables used: 
Sources:
1. Tidytuesday Spotify dataset by @ttspotify
2. Wikipedia Sites 


*For Map* 
- `track_artist`: list of all artist who's songs have made it to the top 100 songs 
- `hometown`: hometown is distinct from bornplace, hometown is where the artist grew up
- `Weight`: how many artist were raised in a given location 
- `geometry`: spatial data that stored in polygons (boundary areas across the globe)

*Bar* -- 




*For Network*
- `track_artist`: list of all artist who's songs have made it to the top 100 songs 
- `hometown`: hometown is distinct from bornplace, hometown is where the artist grew up
- `collabArtist`: the names of artist (exclusively artist listed in the top 100) who have worked with (in any capacity) with track artist



```{r}
## Find Your Favorite Artists Hometown
#| label: Find Your Artist's Hometown
#| message: false
#| out-width: 100%
#| fig-height: 10

Mapplot1<- leaflet(NorthAmericaTotal)|>
  addTiles()|> #This although redunant wouldn't actually show the map without it
  addProviderTiles("CartoDB.DarkMatter")|>
  addPolygons(
    fillColor= "darkgreen",
    fillOpacity = 0.5,
    color="black",
    label = ~ track_artist,
    highlightOptions = highlightOptions(
    weight= 3,# want thick borders
    bringToFront = TRUE,
    )
  )

Mapplot1

```








```{r}
# Bar chart Representing Popularity by Genre 
#| label: Who's the Most Popular Spotify Artist ?
#| message: false
#| out-width: 100%
#| fig-height: 10

#Only Need One Valence 
popularity<- popularity|>
  distinct(track_artist, .keep_all = TRUE)

Bar_Plot1 <- popularity |> 
  filter(Count>1)|>
  ggplot(aes(x= track_artist, y = Count, fill = genre)) +
  geom_bar(stat= "identity", color = "black") +
  geom_text(aes(label= Max_valence), 
            position= position_stack(vjust =1.15),
            size = 3, color = "blue") +
  labs(x= "Track Artist",
       y ="Count",
       fill= "Genre") +
  theme_classic() +
  coord_flip()+
  theme(axis.text.x= element_text(angle= 90, vjust= 0.5, hjust= 1))

Bar_Plot1
```



```{r}
## Network Map for Artist Collaboration : Degree Centrality 
#| label: Network Map: Degree Centrality 
#| message: false
#| out-width: 100%
#| fig-height: 10

#Getting rid of all the repeative information 
artists<- artists|>
  distinct(track_artist, collabArtist, .keep_all = TRUE)

# Create the Nodes and Edges for a visble Graph 
artistcollab_network <- artists |>
      select(track_artist, collabArtist, genre) |>
      as_tbl_graph(directed=FALSE)

gorder(artistcollab_network) #Number of Nodes 
gsize(artistcollab_network) # Number of Edges 

# Transfer genre info to nodes for ggplot to read it correctly 
artistcollab_network <- artistcollab_network |>
  activate(nodes) |>
  left_join(
    artists |> 
      select(name = track_artist, genre, collabArtist) |> 
      distinct(name, .keep_all = TRUE),
    by = "name"
  )

#Filtering to make graph more readability by decreasing data points (Note to Self-- Refer to Lab 10)
#Reporting the ones with the most connections for a more interesting data 

#adding degree information to know which artist is most connectioned 
artistcollab_network<- artistcollab_network|>
  activate(nodes)|>
  mutate(degree= centrality_degree())


artistcollab_network_Sliced<- artistcollab_network|>
  activate(nodes)|>
  arrange(desc(degree))|>
  slice(1:50)

```




```{r}
#Plot: 


Plot2<- plot(artistcollab_network_Sliced,
  layout = layout.circle,
  main = "Circle Layout",
  vertex.color = "black",       # Node color
  vertex.frame.color = "black",   # Border of nodes
  vertex.label.color = "black",# Label color
  edge.color = "green"
)

##| message: false
##| out-width: 100%
##| fig-height: 10 


Plot2

```





#Analysis 




#Analysis 





##Conclusions 


# Sources 
*https://stackoverflow.com/questions/15999877/correctly-color-vertices-in-r-igraph 

